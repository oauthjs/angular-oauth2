!function(e,t){"function"==typeof define&&define.amd?define(["angular","query-string"],t):"object"==typeof exports?module.exports=t(require("angular"),require("query-string")):e.angularOAuth2=t(e.angular,e.queryString)}(this,function(e,t){function n(e){e.interceptors.push("oauthInterceptor")}function r(e,t,n){return{request:function(e){return n.getAuthorizationHeader()&&(e.headers=e.headers||{},e.headers.Authorization=n.getAuthorizationHeader()),e},responseError:function(r){return 400!==r.status||!r.data||"invalid_request"!==r.data.error&&"invalid_grant"!==r.data.error||(n.removeToken(),t.$emit("oauth:error",r)),(401===r.status&&r.data&&"invalid_token"===r.data.error||r.headers("www-authenticate")&&0===r.headers("www-authenticate").indexOf("Bearer"))&&t.$emit("oauth:error",r),e.reject(r)}}}function o(){var n;this.configure=function(t){if(n)throw new Error("Already configured.");if(!(t instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return n=e.extend({},c,t),e.forEach(l,function(e){if(!n[e])throw new Error("Missing parameter: "+e+".")}),"/"===n.baseUrl.substr(-1)&&(n.baseUrl=n.baseUrl.slice(0,-1)),"/"!==n.grantPath[0]&&(n.grantPath="/"+n.grantPath),"/"!==n.revokePath[0]&&(n.revokePath="/"+n.revokePath),n},this.$get=function(r,o){var i=function(){function i(){if(!n)throw new Error("`OAuthProvider` must be configured first.")}return s(i,null,{isAuthenticated:{value:function(){return!!o.getToken()},writable:!0,enumerable:!0,configurable:!0},getAccessToken:{value:function(i,a){if(!i||!i.username||!i.password)throw new Error("`user` must be an object with `username` and `password` properties.");var u={client_id:n.clientId,grant_type:"password",username:i.username,password:i.password};return null!==n.clientSecret&&(u.client_secret=n.clientSecret),u=t.stringify(u),a=e.extend({headers:{"Content-Type":"application/x-www-form-urlencoded"}},a),r.post(""+n.baseUrl+n.grantPath,u,a).then(function(e){return o.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){var e={client_id:n.clientId,grant_type:"refresh_token",refresh_token:o.getRefreshToken()};null!==n.clientSecret&&(e.client_secret=n.clientSecret),e=t.stringify(e);var i={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return r.post(""+n.baseUrl+n.grantPath,e,i).then(function(e){return o.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},revokeToken:{value:function(){var e=t.stringify({token:o.getRefreshToken()?o.getRefreshToken():o.getAccessToken()}),i={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return r.post(""+n.baseUrl+n.revokePath,e,i).then(function(e){return o.removeToken(),e})},writable:!0,enumerable:!0,configurable:!0}}),i}();return new i},this.$get.$inject=["$http","OAuthToken"]}function i(t){var n={name:"token",storage:"cookies",options:{secure:!0}};this.configure=function(r){if(!(r instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return e.extend(n,r),t.invoke(function(e){e.configure(n)}),n},this.$get=function(e){var t=function(){function t(){}return s(t,null,{setToken:{value:function(t){return e.setToken(t)},writable:!0,enumerable:!0,configurable:!0},getToken:{value:function(){return e.getToken()},writable:!0,enumerable:!0,configurable:!0},getAccessToken:{value:function(){return this.getToken()?this.getToken().access_token:void 0},writable:!0,enumerable:!0,configurable:!0},getAuthorizationHeader:{value:function(){return this.getTokenType()&&this.getAccessToken()?""+(this.getTokenType().charAt(0).toUpperCase()+this.getTokenType().substr(1))+" "+this.getAccessToken():void 0},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){return this.getToken()?this.getToken().refresh_token:void 0},writable:!0,enumerable:!0,configurable:!0},getTokenType:{value:function(){return this.getToken()?this.getToken().token_type:void 0},writable:!0,enumerable:!0,configurable:!0},removeToken:{value:function(){return e.deleteToken()},writable:!0,enumerable:!0,configurable:!0}}),t}();return new t},this.$get.$inject=["OAuthStorage"]}function a(){var t={name:"token",storage:"cookies",options:{secure:!0}};this.configure=function(n){return e.extend(t,n),t},this.$get=function(n,r,o,i){var a,u=t.storage.toLowerCase();"localstorage"===u?a=n:"sessionstorage"===u?a=r:"cookies"===u?a=o:(a=o,i.warn("Set storage to cookies, because storage type is unknown"));var c=function(){function t(e,t){this.storage=e,this.name=t}return s(t,null,{setToken:{value:function(t){return this.storage[this.name]=e.toJson(t)},writable:!0,enumerable:!0,configurable:!0},getToken:{value:function(){return e.fromJson(this.storage[this.name])},writable:!0,enumerable:!0,configurable:!0},deleteToken:{value:function(){delete this.storage[this.name]},writable:!0,enumerable:!0,configurable:!0}}),t}(),l=function(){function e(e,t,n){this.$cookies=e,this.name=t,this.options=n}return s(e,null,{setToken:{value:function(e){return this.$cookies.putObject(this.name,e,this.options)},writable:!0,enumerable:!0,configurable:!0},getToken:{value:function(){return this.$cookies.getObject(this.name)},writable:!0,enumerable:!0,configurable:!0},deleteToken:{value:function(){return this.$cookies.remove(this.name,this.options)},writable:!0,enumerable:!0,configurable:!0}}),e}(),f=function(){function e(e){this.storage=e}return s(e,null,{setToken:{value:function(e){return this.storage.setToken(e)},writable:!0,enumerable:!0,configurable:!0},getToken:{value:function(){return this.storage.getToken()},writable:!0,enumerable:!0,configurable:!0},deleteToken:{value:function(){return this.storage.deleteToken()},writable:!0,enumerable:!0,configurable:!0}}),e}();return a="cookies"===u?new l(a,t.name,t.options):new c(a,t.name),new f(a)},this.$get.$inject=["$localStorage","$sessionStorage","$cookies","$log"]}var u=e.module("angular-oauth2",["ngCookies","ngStorage"]).config(n).factory("oauthInterceptor",r).provider("OAuth",o).provider("OAuthToken",i).provider("OAuthStorage",a);n.$inject=["$httpProvider"],r.$inject=["$q","$rootScope","OAuthToken"];var s=function(e,t,n){t&&Object.defineProperties(e,t),n&&Object.defineProperties(e.prototype,n)},c={baseUrl:null,clientId:null,clientSecret:null,grantPath:"/oauth2/token",revokePath:"/oauth2/revoke"},l=["baseUrl","clientId","grantPath","revokePath"],s=function(e,t,n){t&&Object.defineProperties(e,t),n&&Object.defineProperties(e.prototype,n)},s=function(e,t,n){t&&Object.defineProperties(e,t),n&&Object.defineProperties(e.prototype,n)};return u});